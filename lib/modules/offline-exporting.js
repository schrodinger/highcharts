/*
 @product.name@ JS v@product.version@ (@product.date@)
 Client side exporting module

 (c) 2015 Torstein Honsi / Oystein Moseng

 License: www.highcharts.com/license
*/
(function(b){b.CanVGRenderer={};b.Chart.prototype.exportChartLocal=function(z,A){var h=this,e=b.merge(h.options.exporting,z),B=-1<navigator.userAgent.indexOf("WebKit")&&0>navigator.userAgent.indexOf("Chrome"),n=e.scale||2,p,t=window.URL||window.webkitURL||window,l,u=0,q,g,v,d=function(){if(!1===e.fallbackToExportServer)throw"Fallback to export server disabled";h.exportChart(e)},w=function(a,f,c,m,d,b,e){var k=new Image;k.onload=function(){var b=document.createElement("canvas"),h=b.getContext&&b.getContext("2d"),
l;if(h){b.height=k.height*n;b.width=k.width*n;h.drawImage(k,0,0,b.width,b.height);try{l=b.toDataURL(),c(l,f)}catch(g){if("SecurityError"===g.name||"SECURITY_ERR"===g.name||"SecurityError"===g.message)m(a,f);else throw g;}}else d(a,f);e&&e(a,f)};k.onerror=function(){b(a,f);e&&e(a,f)};k.src=a},x=function(a){try{if(!B&&0>navigator.userAgent.toLowerCase().indexOf("firefox"))return t.createObjectURL(new Blob([a],{type:"image/svg+xml;charset-utf-16"}))}catch(b){}return"data:image/svg+xml;charset=UTF-8,"+
encodeURIComponent(a)},r=function(a,b){var c=document.createElement("a"),m=(e.filename||"chart")+"."+b,d;if(navigator.msSaveOrOpenBlob)navigator.msSaveOrOpenBlob(a,m);else if("undefined"!==typeof c.download)c.href=a,c.download=m,c.target="_blank",document.body.appendChild(c),c.click(),document.body.removeChild(c);else try{if(d=window.open(a,"chart"),"undefined"===typeof d||null===d)throw 1;}catch(h){window.location.href=a}},y=function(){var a,f,c=h.sanitizeSVG(p.innerHTML);if(e&&"image/svg+xml"===
e.type)try{navigator.msSaveOrOpenBlob?(f=new MSBlobBuilder,f.append(c),a=f.getBlob("image/svg+xml")):a=x(c),r(a,"svg")}catch(m){d()}else a=x(c),w(a,{},function(a){try{r(a,"png")}catch(b){d()}},function(){var a=document.createElement("canvas"),e=a.getContext("2d"),f=c.match(/^<svg[^>]*width\s*=\s*\"?(\d+)\"?[^>]*>/)[1]*n,g=c.match(/^<svg[^>]*height\s*=\s*\"?(\d+)\"?[^>]*>/)[1]*n,k=function(){e.drawSvg(c,0,0,f,g);try{r(navigator.msSaveOrOpenBlob?a.msToBlob():a.toDataURL("image/png"),"png")}catch(b){d()}};
a.width=f;a.height=g;window.canvg?k():(h.showLoading(),HighchartsAdapter.getScript(b.getOptions().global.canvasToolsURL,function(){h.hideLoading();k()}))},d,d,function(){try{t.revokeObjectURL(a)}catch(b){}})};b.wrap(b.Chart.prototype,"getChartHTML",function(a){p=this.container.cloneNode(!0);return a.apply(this,Array.prototype.slice.call(arguments,1))});h.getSVGForExport(e,A);l=p.getElementsByTagName("image");try{var C=function(a,b){++u;b.imageElement.setAttributeNS("http://www.w3.org/1999/xlink",
"href",a);u===l.length&&y()};l.length||y();g=0;for(v=l.length;g<v;++g)q=l[g],w(q.getAttributeNS("http://www.w3.org/1999/xlink","href"),{imageElement:q},C,d,d,d)}catch(a){d()}};b.getOptions().exporting.buttons.contextButton.menuItems=[{textKey:"printChart",onclick:function(){this.print()}},{separator:!0},{textKey:"downloadPNG",onclick:function(){this.exportChartLocal()}},{textKey:"downloadSVG",onclick:function(){this.exportChartLocal({type:"image/svg+xml"})}}]})(Highcharts);